# Memory set/cpy/move benchmarks

## Hardware

Loongson-3a5000 quad-core machine (2.3GHz)

## Software

Arch Linux glibc 2.37-1

## Results

* length: byte
* speed: MB/s

### Memset

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 1      | 0          | 0          | 62.39       | 242.49    | 242.58    | 242.59     |
| 1      | 0          | 1          | 61.83       | 242.66    | 242.66    | 242.66     |
| 8      | 0          | 0          | 419.78      | 1940.63   | 1940.66   | 1941.15    |
| 8      | 0          | 1          | 291.21      | 1941.35   | 1941.30   | 1941.23    |
| 16     | 0          | 0          | 834.68      | 3894.38   | 3893.93   | 3892.89    |
| 16     | 0          | 1          | 574.76      | 3895.23   | 3895.37   | 3895.32    |
| 24     | 0          | 0          | 1149.93     | 5836.86   | 5836.01   | 5834.73    |
| 24     | 0          | 1          | 847.57      | 5838.35   | 5838.14   | 5838.56    |
| 32     | 0          | 0          | 1524.17     | 7008.50   | 7787.71   | 7787.99    |
| 32     | 0          | 1          | 1076.94     | 7791.12   | 7788.84   | 7790.98    |
| 64     | 0          | 0          | 3392.65     | 14009.42  | 14015.62  | 14018.16   |
| 64     | 0          | 1          | 2032.46     | 15581.95  | 15581.38  | 14022.53   |
| 300    | 0          | 0          | 10186.27    | 17295.86  | 34581.78  | 54742.08   |
| 300    | 0          | 1          | 8218.45     | 17302.14  | 34598.52  | 54781.40   |
| 1200   | 0          | 0          | 15272.95    | 17510.27  | 35025.02  | 69007.14   |
| 1200   | 0          | 1          | 14130.35    | 17404.98  | 34552.23  | 67353.95   |
| 4000   | 0          | 0          | 16782.96    | 17523.50  | 35039.75  | 69488.75   |
| 4000   | 0          | 1          | 16370.04    | 17494.15  | 34911.41  | 69552.13   |
| 8000   | 0          | 0          | 16971.97    | 17532.27  | 35058.09  | 69812.14   |
| 8000   | 0          | 1          | 16748.00    | 17516.56  | 34998.97  | 69848.90   |

### Memcpy

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 1      | 0          | 0          | 50.63       | 198.44    | 198.50    | 218.34     |
| 1      | 0          | 1          | 50.41       | 198.54    | 198.54    | 218.40     |
| 8      | 0          | 0          | 335.99      | 1587.80   | 1587.88   | 1746.65    |
| 8      | 0          | 1          | 336.00      | 1588.31   | 1588.33   | 1746.60    |
| 16     | 0          | 0          | 601.09      | 3186.34   | 3186.61   | 3503.77    |
| 16     | 0          | 1          | 500.86      | 3187.08   | 3095.69   | 3505.91    |
| 24     | 0          | 0          | 921.74      | 4775.41   | 4775.34   | 5252.96    |
| 24     | 0          | 1          | 740.12      | 4776.83   | 4584.13   | 5254.60    |
| 32     | 0          | 0          | 1230.03     | 5006.45   | 6371.90   | 7008.27    |
| 32     | 0          | 1          | 973.89      | 5393.53   | 6373.99   | 7009.88    |
| 64     | 0          | 0          | 2298.78     | 10013.13  | 10012.43  | 14016.31   |
| 64     | 0          | 1          | 1775.16     | 10785.69  | 10787.19  | 14022.53   |
| 300    | 0          | 0          | 6993.39     | 17135.75  | 33878.23  | 43797.86   |
| 300    | 0          | 1          | 4858.84     | 15654.08  | 27856.24  | 43802.89   |
| 1200   | 0          | 0          | 13005.23    | 17513.85  | 34557.45  | 67632.85   |
| 1200   | 0          | 1          | 7964.34     | 14626.55  | 24218.03  | 36784.81   |
| 4000   | 0          | 0          | 15871.69    | 17508.01  | 34751.50  | 69425.48   |
| 4000   | 0          | 1          | 9148.23     | 15567.90  | 27992.44  | 41400.84   |
| 8000   | 0          | 0          | 16480.13    | 17289.25  | 35026.29  | 64865.21   |
| 8000   | 0          | 1          | 9482.58     | 15524.74  | 27851.31  | 40644.78   |

### Memmove

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 1      | 0          | 0          | 50.786      | 183.355   | 183.378   | 181.963    |
| 1      | 0          | 1          | 50.410      | 181.992   | 181.964   | 181.996    |
| 8      | 0          | 0          | 317.655     | 1484.723  | 1455.228  | 1455.799   |
| 8      | 0          | 1          | 315.767     | 1455.967  | 1455.953  | 1455.967   |
| 16     | 0          | 0          | 594.185     | 2942.567  | 2865.518  | 2920.337   |
| 16     | 0          | 1          | 547.815     | 2921.512  | 2921.512  | 2921.568   |
| 24     | 0          | 0          | 906.297     | 4376.487  | 4377.924  | 4377.206   |
| 24     | 0          | 1          | 808.426     | 4378.763  | 4378.463  | 4378.763   |
| 32     | 0          | 0          | 1208.824    | 6372.564  | 5841.233  | 5840.355   |
| 32     | 0          | 1          | 1062.398    | 6373.991  | 5842.832  | 5973.615   |
| 64     | 0          | 0          | 2261.611    | 11682.786 | 12740.564 | 11677.834  |
| 64     | 0          | 1          | 1921.100    | 11685.664 | 12748.171 | 11686.463  |
| 300    | 0          | 0          | 7145.132    | 17290.631 | 31221.003 | 32353.856  |
| 300    | 0          | 1          | 5156.382    | 14846.538 | 18611.916 | 24347.678  |
| 1200   | 0          | 0          | 13197.638   | 17397.038 | 34289.713 | 62912.693  |
| 1200   | 0          | 1          | 8751.005    | 14636.228 | 23687.845 | 28682.527  |
| 4000   | 0          | 0          | 15926.061   | 17487.930 | 34897.025 | 69498.245  |
| 4000   | 0          | 1          | 10527.260   | 15567.261 | 27903.828 | 40556.353  |
| 8000   | 0          | 0          | 16538.647   | 17341.040 | 34991.341 | 65147.762  |
| 8000   | 0          | 1          | 11077.225   | 15531.460 | 27716.206 | 40377.973  |

## Memory libraries

### Build

```bash
make lib
```

### Install

```bash
# Int
cp libmem-int.so /usr/local/lib/
echo '/usr/local/lib/libmem-int.so' > /etc/ld.so.preload

# LSX
sudo cp libmem-lsx.so /usr/local/lib/
echo '/usr/local/lib/libmem-lsx.so' > /etc/ld.so.preload

# LASX
sudo cp libmem-lasx.so /usr/local/lib/
echo '/usr/local/lib/libmem-lasx.so' > /etc/ld.so.preload
```
