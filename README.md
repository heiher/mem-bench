# Memory set/cpy/move benchmarks

## Hardware

Loongson-3a5000 quad-core machine (2.3GHz)

## Software

Arch Linux glibc 2.37-1

## Results

* length: byte
* speed: MB/s

### Memset

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 1      | 0          | 0          | 62.39       | 242.49    | 242.58    | 242.59     |
| 1      | 0          | 1          | 61.83       | 242.66    | 242.66    | 242.66     |
| 8      | 0          | 0          | 419.78      | 1940.63   | 1940.66   | 1941.15    |
| 8      | 0          | 1          | 291.21      | 1941.35   | 1941.30   | 1941.23    |
| 16     | 0          | 0          | 834.68      | 3894.38   | 3893.93   | 3892.89    |
| 16     | 0          | 1          | 574.76      | 3895.23   | 3895.37   | 3895.32    |
| 24     | 0          | 0          | 1149.93     | 5836.86   | 5836.01   | 5834.73    |
| 24     | 0          | 1          | 847.57      | 5838.35   | 5838.14   | 5838.56    |
| 32     | 0          | 0          | 1524.17     | 7008.50   | 7787.71   | 7787.99    |
| 32     | 0          | 1          | 1076.94     | 7791.12   | 7788.84   | 7790.98    |
| 64     | 0          | 0          | 3392.65     | 14009.42  | 14015.62  | 14018.16   |
| 64     | 0          | 1          | 2032.46     | 15581.95  | 15581.38  | 14022.53   |
| 300    | 0          | 0          | 10186.27    | 17295.86  | 34581.78  | 54742.08   |
| 300    | 0          | 1          | 8218.45     | 17302.14  | 34598.52  | 54781.40   |
| 1200   | 0          | 0          | 15272.95    | 17510.27  | 35025.02  | 69007.14   |
| 1200   | 0          | 1          | 14130.35    | 17404.98  | 34552.23  | 67353.95   |
| 4000   | 0          | 0          | 16782.96    | 17523.50  | 35039.75  | 69488.75   |
| 4000   | 0          | 1          | 16370.04    | 17494.15  | 34911.41  | 69552.13   |
| 8000   | 0          | 0          | 16971.97    | 17532.27  | 35058.09  | 69812.14   |
| 8000   | 0          | 1          | 16748.00    | 17516.56  | 34998.97  | 69848.90   |

### Memcpy

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 1      | 0          | 0          | 50.63       | 198.44    | 198.50    | 218.34     |
| 1      | 0          | 1          | 50.41       | 198.54    | 198.54    | 218.40     |
| 8      | 0          | 0          | 335.99      | 1587.80   | 1587.88   | 1746.65    |
| 8      | 0          | 1          | 336.00      | 1588.31   | 1588.33   | 1746.60    |
| 16     | 0          | 0          | 601.09      | 3186.34   | 3186.61   | 3503.77    |
| 16     | 0          | 1          | 500.86      | 3187.08   | 3095.69   | 3505.91    |
| 24     | 0          | 0          | 921.74      | 4775.41   | 4775.34   | 5252.96    |
| 24     | 0          | 1          | 740.12      | 4776.83   | 4584.13   | 5254.60    |
| 32     | 0          | 0          | 1230.03     | 5006.45   | 6371.90   | 7008.27    |
| 32     | 0          | 1          | 973.89      | 5393.53   | 6373.99   | 7009.88    |
| 64     | 0          | 0          | 2298.78     | 10013.13  | 10012.43  | 14016.31   |
| 64     | 0          | 1          | 1775.16     | 10785.69  | 10787.19  | 14022.53   |
| 300    | 0          | 0          | 6993.39     | 17135.75  | 33878.23  | 43797.86   |
| 300    | 0          | 1          | 4858.84     | 15654.08  | 27856.24  | 43802.89   |
| 1200   | 0          | 0          | 13005.23    | 17513.85  | 34557.45  | 67632.85   |
| 1200   | 0          | 1          | 7964.34     | 14626.55  | 24218.03  | 36784.81   |
| 4000   | 0          | 0          | 15871.69    | 17508.01  | 34751.50  | 69425.48   |
| 4000   | 0          | 1          | 9148.23     | 15567.90  | 27992.44  | 41400.84   |
| 8000   | 0          | 0          | 16480.13    | 17289.25  | 35026.29  | 64865.21   |
| 8000   | 0          | 1          | 9482.58     | 15524.74  | 27851.31  | 40644.78   |

### Memmove

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 1      | 0          | 0          | 50.79       | 198.44    | 198.42    | 218.36     |
| 1      | 0          | 1          | 50.79       | 198.54    | 198.53    | 218.40     |
| 8      | 0          | 0          | 335.76      | 1587.98   | 1587.95   | 1746.71    |
| 8      | 0          | 1          | 336.01      | 1588.11   | 1588.30   | 1747.13    |
| 16     | 0          | 0          | 604.44      | 3186.38   | 3186.34   | 3504.94    |
| 16     | 0          | 1          | 500.85      | 3187.11   | 3187.14   | 3505.87    |
| 24     | 0          | 0          | 921.81      | 4774.20   | 4775.48   | 5252.70    |
| 24     | 0          | 1          | 740.12      | 4776.26   | 4776.83   | 5254.43    |
| 32     | 0          | 0          | 1230.06     | 5007.39   | 6371.90   | 7008.16    |
| 32     | 0          | 1          | 967.61      | 5393.32   | 6373.99   | 7011.03    |
| 64     | 0          | 0          | 2298.68     | 10013.72  | 10011.84  | 14019.54   |
| 64     | 0          | 1          | 1764.84     | 10786.78  | 10787.05  | 14021.84   |
| 300    | 0          | 0          | 6992.75     | 17086.10  | 33935.51  | 43796.18   |
| 300    | 0          | 1          | 4853.88     | 15653.86  | 27877.28  | 43817.99   |
| 1200   | 0          | 0          | 13001.54    | 17504.47  | 34550.49  | 67779.86   |
| 1200   | 0          | 1          | 7964.61     | 14637.79  | 24149.83  | 37441.33   |
| 4000   | 0          | 0          | 15873.84    | 17503.99  | 34764.97  | 69469.75   |
| 4000   | 0          | 1          | 9148.23     | 15567.74  | 28002.20  | 41381.74   |
| 8000   | 0          | 0          | 16484.14    | 17290.23  | 35021.47  | 64826.62   |
| 8000   | 0          | 1          | 9566.12     | 15524.82  | 27706.14  | 40249.07   |

## Memory libraries

### Build

```bash
make lib
```

### Install

```bash
# Int
cp libmem-int.so /usr/local/lib/
echo '/usr/local/lib/libmem-int.so' > /etc/ld.so.preload

# LSX
sudo cp libmem-lsx.so /usr/local/lib/
echo '/usr/local/lib/libmem-lsx.so' > /etc/ld.so.preload

# LASX
sudo cp libmem-lasx.so /usr/local/lib/
echo '/usr/local/lib/libmem-lasx.so' > /etc/ld.so.preload
```
