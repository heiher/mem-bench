# Memory set/cpy/move benchmarks

## Hardware

Loongson-3a5000 quad-core machine (2.3GHz)

## Software

Arch Linux glibc 2.37-1

## Results

* length: byte
* speed: MB/s

### Memset

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 8      | 0          | 0          | 417.748     | 1940.905  | 1940.657  | 1940.459   |
| 8      | 0          | 1          | 291.201     | 1941.252  | 1941.276  | 1941.276   |
| 50     | 0          | 0          | 2190.332    | 9123.863  | 9951.511  | 9124.861   |
| 50     | 0          | 1          | 1521.279    | 7822.212  | 9126.859  | 9126.984   |
| 300    | 0          | 0          | 10197.896   | 17293.506 | 34581.784 | 54755.181  |
| 300    | 0          | 1          | 8218.627    | 17300.829 | 34592.241 | 54757.802  |
| 1200   | 0          | 0          | 15270.914   | 17512.509 | 34983.936 | 69083.585  |
| 1200   | 0          | 1          | 14130.345   | 17398.803 | 34566.159 | 67314.297  |
| 4000   | 0          | 0          | 16784.248   | 17523.499 | 35038.14  | 61583.815  |
| 4000   | 0          | 1          | 16368.457   | 17494.35  | 34917.8   | 69545.786  |
| 8000   | 0          | 0          | 16971.403   | 17530.956 | 35058.488 | 69824.923  |
| 8000   | 0          | 1          | 16747.633   | 17517.77  | 35000.574 | 69855.298  |

### Memcpy

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 8      | 0          | 0          | 335.944     | 1746.705  | 1746.303  | 1746.785   |
| 8      | 0          | 1          | 336.008     | 1747.126  | 1747.147  | 1747.147   |
| 50     | 0          | 0          | 1766.443    | 8633.969  | 9110.653  | 8996.008   |
| 50     | 0          | 1          | 1369.123    | 6754.294  | 9126.734  | 9127.234   |
| 300    | 0          | 0          | 6993.605    | 17026.597 | 31285.894 | 38642.121  |
| 300    | 0          | 1          | 4856.945    | 15653.221 | 27828.456 | 38664.323  |
| 1200   | 0          | 0          | 13005.232   | 17508.039 | 34552.231 | 64425.244  |
| 1200   | 0          | 1          | 7964.427    | 14622.812 | 24116.716 | 36965.19   |
| 4000   | 0          | 0          | 15869.877   | 17512.431 | 34766.551 | 69457.096  |
| 4000   | 0          | 1          | 9148.17     | 15567.579 | 28001.175 | 41250.778  |
| 8000   | 0          | 0          | 16487.614   | 17305.827 | 35019.455 | 64847.287  |
| 8000   | 0          | 1          | 9566.483    | 15521.662 | 27772.215 | 40577.744  |

### Memmove

| length | src offset | dst offset | speed glibc | speed int | speed lsx | speed lasx |
|--------|------------|------------|-------------|-----------|-----------|------------|
| 8      | 0          | 0          | 335.968     | 1746.745  | 1746.845  | 1746.725   |
| 8      | 0          | 1          | 336.013     | 1746.845  | 1747.147  | 1747.147   |
| 50     | 0          | 0          | 1766.494    | 8744.674  | 9124.362  | 9092.396   |
| 50     | 0          | 1          | 1369.101    | 6776.045  | 9127.109  | 9126.984   |
| 300    | 0          | 0          | 6993.221    | 17136.01  | 31291.028 | 38643.427  |
| 300    | 0          | 1          | 4851.363    | 15653.221 | 28000.098 | 38663.017  |
| 1200   | 0          | 0          | 13004.739   | 17511.615 | 34557.453 | 68986.323  |
| 1200   | 0          | 1          | 7964.427    | 14604.756 | 24408.468 | 36792.706  |
| 4000   | 0          | 0          | 15872.355   | 17504.993 | 34757.835 | 69495.078  |
| 4000   | 0          | 1          | 9148.115    | 15567.579 | 28000.147 | 41448.102  |
| 8000   | 0          | 0          | 16484.674   | 17306.122 | 35039.565 | 64819.733  |
| 8000   | 0          | 1          | 9566.483    | 15512.902 | 27691.051 | 40372.095  |

## Memory libraries

### Build

```bash
make lib
```

### Install

```bash
# Int
cp libmem-int.so /usr/local/lib/
echo '/usr/local/lib/libmem-int.so' > /etc/ld.so.preload

# LSX
sudo cp libmem-lsx.so /usr/local/lib/
echo '/usr/local/lib/libmem-lsx.so' > /etc/ld.so.preload

# LASX
sudo cp libmem-lasx.so /usr/local/lib/
echo '/usr/local/lib/libmem-lasx.so' > /etc/ld.so.preload
```
